(function(e){e.fn.boxtree=function(t){function r(n){e(n).each(function(){e(this).closest(t.node).toggleClass("checked",e(n).is(":checked")).toggleClass("indeterminate",e(n).prop("indeterminate")===!0)})}function i(e){e.parent().hasClass("active")?e.find("i").removeClass("icon-plus-sign").addClass("icon-minus-sign"):e.find("i").removeClass("icon-minus-sign").addClass("icon-plus-sign")}function s(n,i){if(!n.length)return;var o=n.parent().parent(),u=!0,a=o.children(t.node).find(":checkbox");n.siblings().not(".empty").each(function(){return u=e(this).find(":checkbox").prop("checked")===i});if(u&&i){e(":checkbox",o).prop({indeterminate:!1,checked:i});r(a);s(o,i)}else if(u&&!i){a.prop("checked",i);a.prop("indeterminate",o.find(":checked").length);r(a);s(o,i)}else{n.parents("li").children(t.node).find(":checkbox").prop({indeterminate:!0,checked:!1});r(n.parents("li").children(t.node).find(":checkbox"))}}var n={container:this,tree:".tree",node:".node",nodeBtnLabel:".node label",nodeDepth:".greatgrandchild"},t=e.extend(n,t);e(t.node,t.tree).click(function(){if(!e(this).is(t.nodeDepth)){e(this).parent().toggleClass("active");i(e(this))}});t.container.on("click",".check-all-nodes",function(){e(t.tree+" :checkbox").not(e(".added "+t.node+" :checkbox")).attr("checked","checked").trigger("change");r()}).on("click",".uncheck-all-nodes",function(){e(t.tree+" :checkbox").not(e(".added "+t.node+" :checkbox")).removeAttr("checked").trigger("change");r()}).on("click",".expand-all-nodes",function(){e(t.node,t.tree).each(function(){e(this).parent().addClass("active");e(t.nodeDepth).parent().removeClass("active");i(e(this))})}).on("click",".collapse-all-nodes",function(){e(t.node,t.tree).each(function(){e(this).parent().removeClass("active");i(e(this))})});e(t.nodeBtnLabel).on("click",function(e){e.stopPropagation()});e(":checkbox",t.tree).on("change",function(t){t.stopPropagation();var n=e(this).prop("checked"),i=e(this.parentNode.parentNode.parentNode),o=e(":checkbox",i).not(e(".added :checked"));o.prop({indeterminate:!1,checked:n});r(o);i.parent("#parent-list").length||s(i,n);r(this)});s(e(t.nodeDepth+" :checked").closest("li"),!0)}})(jQuery);